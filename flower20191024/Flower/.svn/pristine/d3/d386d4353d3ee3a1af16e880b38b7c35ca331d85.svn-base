<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="Bookmark" href="/favicon.ico" >
<link rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>

<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<link rel="stylesheet" type="text/css" href="lib/layui/css/layui.css" />
<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->
</head>
<body>
<div class="page-container">
	<form action="" method="post" class="form form-horizontal" id="form-article-add">
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品网页标题：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="title" name="产品标题">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="name" name="产品名称">
			</div>
		</div>
		<!-- 隐藏域用于保存图片 -->
		<input hidden="true" type="text" class="input-text" value="" placeholder="" id="id" name="商品Id">
		
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>产品详情：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="desc" name="产品详情">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>价格：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="number" class="input-text" value="" placeholder="" id="price" name="价格">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>数量：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="number" class="input-text" value="" placeholder="" id="num" name="数量">
			</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>商品状态：</label>
			<div class="formControls col-xs-3 col-sm-3"> <span class="select-box">
				<select name="商品状态" class="select" id="status">
					<option value="1" selected="selected">上架</option>
					<option value="0" selected="selected">下架</option>
				</select>
				</span> </div>
		</div>
		<div class="row cl">
		<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>结束时间：</label>
			<div class="formControls col-xs-8 col-sm-9">
 		 	<input type="text" class="layui-input" id="end">
			</div>
		</div>
		<div class="layui-upload">
		<div class="row cl">
		<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
  			<button type="button" class="layui-btn" id="test2">多图片上传</button> 
		<div id="preview" style="width:300px;">
		</div>
		</div>
		</div>
		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>图片地址：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" value="" placeholder="" id="img" name="图片信息">
			</div>
		</div>
		</div>
		<div class="row cl">
			<div id="editor" style="width: 80%;margin:0 auto;"></div>
		</div>
		<div class="row cl">
			<div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
				<button  id="submit1"  class="btn btn-primary radius" type="button"><i class="Hui-iconfont">&#xe632;</i> 保存并提交审核</button>
				<button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
			</div>
		</div>
	</form>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="lib/layui/layui.js"></script>
<script type="text/javascript" src="wangEditor/release/wangEditor.js"></script>
<script type="text/javascript">
var E = window.wangEditor
var editor = new E('#editor')
	//开启debug模式
	editor.customConfig.debug = true;
	// 关闭粘贴内容中的样式
	editor.customConfig.pasteFilterStyle = false
	// 忽略粘贴内容中的图片
	editor.customConfig.pasteIgnoreImg = false
	// 使用 base64 保存图片
	//editor.customConfig.uploadImgShowBase64 = true
 
	// 上传图片到服务器
	editor.customConfig.uploadFileName = 'myFile'; //设置文件上传的参数名称
	editor.customConfig.uploadImgServer = '/file/descImg';  //设置上传文件的服务器路径
	editor.customConfig.uploadImgMaxSize = 5 * 2000 * 2000; // 将图片大小限制为 3M
	editor.customConfig.uploadImgMaxLength = 1
	//自定义上传图片事件
	editor.customConfig.uploadImgHooks = {
		before : function(xhr, editor, files) {
			
		},
		success : function(xhr, editor, result) {
			console.log("上传成功");
		},
		fail : function(xhr, editor, result) {
			console.log("上传失败,原因是"+result);
		},
		error : function(xhr, editor) {
			console.log("上传出错");
		},
		timeout : function(xhr, editor) {
			console.log("上传超时");
		}
	}
	editor.create()
$(function (){
	var id=location.search.substring(1);
	params={"id":id};
	$.post("product/doFindById",params,function(result){
		if(result.status!=200){
			alert("数据可能已被删除");
			return;
		}
	
		doEcho(result.data);
	})
$.post("product/doFindProductDesc",params,function(result){
		editor.txt.html(result.data.imgDesc);
	})
})
function doEcho(data){
	var simDateE=new Date(data.end).Format("yyyy-MM-dd HH:mm:ss");
		$("#id").val(data.id);
		$("#title").val(data.title);
		$("#name").val(data.productName);
		$("#desc").val(data.productDesc);
		$("#price").val(data.price);
		$("#num").val(data.num);
		$("#status").val(data.status);
		$("#end").val(simDateE);
		$("#img").val(data.img);
	  }
//提交更新的点击事件
$(function(){
		$("#submit1").click(function(){
			updateProduct();
		})
	})
function updateProduct(){
	debugger
	var params=doGetProductParameter();
	for(var x in params){
	console.log(params[x])
	if(!params[x]){
		alert("请填写必填项"+params[x]);
		return;
	}
	}
	var imgDesc=editor.txt.html();
	var imgDescUrl="product/doUpdateProductDesc";
	var status=saveProductDesc(imgDescUrl,imgDesc);
	if (status!=200) {
		alert("更新失败!请检查");
		return;
	}
	var url="product/doUpdateProduct";
	savaProduct(url,params,imgDesc);
}
function saveProductDesc(url,imgDesc){
	$.post(url,imgDesc,function(result){
		return result.status;
	})
}
function savaProduct(url,params){	
	$.post(url,params, function(result) {
		if(result.status==200){
			alert("更新成功")
			return;
		}
		alert("更新失败")
		parent.location.reload();
		});
}
function doGetProductParameter(){
	var params={
			id:$("#id").val(),
			title:$("#title").val(),
			name:$("#name").val(),
			desc:$("#desc").val(),
			price:$("#price").val(),
			num:$("#num").val(),
			status:$("#status").val(),
			end:$("#end").val(),
			img:$("#img").val()
    	}
	return params;
}
Date.prototype.Format = function (fmt) { 
	var o = {
	"M+": this.getMonth() + 1, //月份
	"d+": this.getDate(), //日
	"H+": this.getHours(), //小时
	"m+": this.getMinutes(), //分
	"s+": this.getSeconds(), //秒
	"q+": Math.floor((this.getMonth() + 3) / 3), //季度
	"S": this.getMilliseconds() //毫秒
	};
	if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
	for (var k in o)
	if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
	return fmt;
	}
</script>
<script>
layui.use('laydate', function(){
	  var laydate = layui.laydate;
	  
	  //执行一个laydate实例
	  laydate.render({
	    elem: '#end' //指定元素
	    ,type: 'datetime'
	  });
	});
	
</script>
</body>
</html>